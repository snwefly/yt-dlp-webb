<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>yt-dlp é«˜çº§ç½‘é¡µç•Œé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="80" r="1.5" fill="rgba(255,255,255,0.1)"/></svg>');
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.2em;
            position: relative;
            z-index: 1;
        }

        .main-content {
            padding: 40px;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }

        .left-panel {
            min-width: 0;
        }

        .right-panel {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            height: fit-content;
            border: 1px solid #e9ecef;
        }

        .input-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            background: white;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .url-input-container {
            position: relative;
        }

        .url-validation {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
        }

        .url-validation.valid {
            color: #27ae60;
        }

        .url-validation.invalid {
            color: #e74c3c;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #7f8c8d;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .format-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .preset-btn {
            padding: 12px;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
        }

        .preset-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .preset-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .checkbox-group input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .checkbox-group label {
            font-weight: 500;
            color: #2c3e50;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        .status-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }

        .status-section.show {
            display: block;
        }

        .video-info {
            background: #e8f4fd;
            border-left: 4px solid #3498db;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
        }

        .video-info h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .video-info p {
            margin-bottom: 5px;
            color: #555;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            margin: 15px 0;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s;
            position: relative;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }

        .download-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: 600;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-top: 5px;
        }

        .downloads-section {
            margin-top: 30px;
        }

        .download-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .download-item.completed {
            border-left-color: #27ae60;
        }

        .download-item.error {
            border-left-color: #e74c3c;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #e74c3c;
        }

        .success-message {
            background: #efe;
            color: #363;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #27ae60;
        }

        /* iOSå¿«æ·æŒ‡ä»¤æ ·å¼ */
        .shortcuts-section {
            margin-top: 30px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            border: 1px solid #e9ecef;
        }

        .shortcuts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .shortcut-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .shortcut-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.15);
        }

        .shortcut-icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
        }

        .shortcut-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .shortcut-card p {
            color: #7f8c8d;
            margin-bottom: 20px;
            font-size: 0.95em;
            line-height: 1.4;
        }

        .shortcut-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn-shortcut {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-shortcut:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-shortcut-guide {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
        }

        .btn-shortcut-guide:hover {
            background: #7f8c8d;
            transform: translateY(-1px);
        }

        .shortcuts-info {
            background: white;
            border-radius: 12px;
            padding: 25px;
            border-left: 4px solid #667eea;
        }

        .shortcuts-info h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .shortcuts-info ol {
            margin-bottom: 25px;
            padding-left: 20px;
        }

        .shortcuts-info li {
            margin-bottom: 8px;
            color: #555;
            line-height: 1.5;
        }

        .server-config {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .server-config code {
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 4px;
            font-family: 'Monaco', 'Consolas', monospace;
            color: #667eea;
            font-weight: 600;
        }

        /* å¼¹çª—æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .modal-header h3 {
            color: #2c3e50;
            margin: 0;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            color: #667eea;
        }

        .guide-content {
            line-height: 1.6;
        }

        .guide-content h4 {
            color: #667eea;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .guide-content code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }

        .guide-content pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            border-left: 4px solid #667eea;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .format-grid {
                grid-template-columns: 1fr;
            }

            .shortcuts-grid {
                grid-template-columns: 1fr;
            }

            .shortcut-buttons {
                flex-direction: row;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>yt-dlp é«˜çº§ç½‘é¡µç•Œé¢</h1>
            <p>åŠŸèƒ½å¼ºå¤§çš„è§†é¢‘ä¸‹è½½å·¥å…· - æ”¯æŒæ•°åƒä¸ªç½‘ç«™</p>
        </div>

        <div class="main-content">
            <div class="left-panel">
                <!-- URLè¾“å…¥åŒºåŸŸ -->
                <div class="input-section">
                    <div class="input-group">
                        <label for="url">è§†é¢‘é“¾æ¥ï¼š</label>
                        <div class="url-input-container">
                            <input type="url" id="url" placeholder="https://www.youtube.com/watch?v=... æˆ–å…¶ä»–æ”¯æŒçš„ç½‘ç«™é“¾æ¥" required>
                            <span id="url-validation" class="url-validation"></span>
                        </div>
                    </div>

                    <!-- å¿«é€Ÿé¢„è®¾ -->
                    <div class="preset-buttons">
                        <div class="preset-btn active" data-preset="best">æœ€ä½³è´¨é‡</div>
                        <div class="preset-btn" data-preset="mp4">MP4è§†é¢‘</div>
                        <div class="preset-btn" data-preset="mp3">MP3éŸ³é¢‘</div>
                        <div class="preset-btn" data-preset="720p">720Pè§†é¢‘</div>
                        <div class="preset-btn" data-preset="480p">480Pè§†é¢‘</div>
                        <div class="preset-btn" data-preset="custom">è‡ªå®šä¹‰</div>
                    </div>

                    <div class="button-group">
                        <button type="button" class="btn-secondary" onclick="getVideoInfo()">
                            <span id="info-btn-text">è·å–è§†é¢‘ä¿¡æ¯</span>
                            <span id="info-loading" class="loading hidden"></span>
                        </button>
                        <button type="button" class="btn-primary" onclick="startDownload()">
                            <span id="download-btn-text">å¼€å§‹ä¸‹è½½</span>
                            <span id="download-loading" class="loading hidden"></span>
                        </button>
                    </div>
                </div>

                <div id="message-area"></div>

                <!-- è§†é¢‘ä¿¡æ¯æ˜¾ç¤º -->
                <div id="video-info-section" class="status-section">
                    <div id="video-info" class="video-info"></div>
                </div>

                <!-- ä¸‹è½½çŠ¶æ€ -->
                <div id="download-status-section" class="status-section">
                    <h3>ä¸‹è½½çŠ¶æ€</h3>
                    <div id="download-status"></div>
                    <div id="progress-container" class="hidden">
                        <div class="progress-bar">
                            <div id="progress-fill" class="progress-fill"></div>
                            <div id="progress-text" class="progress-text">0%</div>
                        </div>
                        <div id="download-stats" class="download-stats">
                            <div class="stat-item">
                                <div id="download-speed" class="stat-value">0 KB/s</div>
                                <div class="stat-label">ä¸‹è½½é€Ÿåº¦</div>
                            </div>
                            <div class="stat-item">
                                <div id="file-size" class="stat-value">0 MB</div>
                                <div class="stat-label">æ–‡ä»¶å¤§å°</div>
                            </div>
                            <div class="stat-item">
                                <div id="eta" class="stat-value">--:--</div>
                                <div class="stat-label">å‰©ä½™æ—¶é—´</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- iOSå¿«æ·æŒ‡ä»¤ä¸‹è½½åŒºåŸŸ -->
                <div class="shortcuts-section">
                    <h3>ğŸ“± iOSå¿«æ·æŒ‡ä»¤</h3>
                    <p style="color: #7f8c8d; margin-bottom: 20px;">ä¸€é”®å®‰è£…ï¼Œåœ¨iPhone/iPadä¸Šç›´æ¥ä¸‹è½½è§†é¢‘</p>

                    <div class="shortcuts-grid">
                        <div class="shortcut-card">
                            <div class="shortcut-icon">ğŸ¬</div>
                            <h4>æ™ºèƒ½è§†é¢‘ä¸‹è½½å™¨</h4>
                            <p>æ”¯æŒæ ¼å¼é€‰æ‹©çš„äº¤äº’å¼ä¸‹è½½å™¨</p>
                            <div class="shortcut-buttons">
                                <button class="btn-shortcut" onclick="downloadShortcut('smart_downloader')">
                                    ğŸ“¥ ä¸‹è½½å¿«æ·æŒ‡ä»¤
                                </button>
                                <button class="btn-shortcut-guide" onclick="showShortcutGuide('smart_downloader')">
                                    ğŸ“– ä½¿ç”¨è¯´æ˜
                                </button>
                            </div>
                        </div>

                        <div class="shortcut-card">
                            <div class="shortcut-icon">ğŸµ</div>
                            <h4>éŸ³é¢‘æå–å™¨</h4>
                            <p>ä¸€é”®æå–è§†é¢‘éŸ³é¢‘ä¸ºMP3</p>
                            <div class="shortcut-buttons">
                                <button class="btn-shortcut" onclick="downloadShortcut('audio_extractor')">
                                    ğŸ“¥ ä¸‹è½½å¿«æ·æŒ‡ä»¤
                                </button>
                                <button class="btn-shortcut-guide" onclick="showShortcutGuide('audio_extractor')">
                                    ğŸ“– ä½¿ç”¨è¯´æ˜
                                </button>
                            </div>
                        </div>

                        <div class="shortcut-card">
                            <div class="shortcut-icon">ğŸ“±</div>
                            <h4>720Pä¸‹è½½å™¨</h4>
                            <p>ä¸“é—¨ä¸‹è½½720Pé«˜æ¸…è§†é¢‘</p>
                            <div class="shortcut-buttons">
                                <button class="btn-shortcut" onclick="downloadShortcut('720p_downloader')">
                                    ğŸ“¥ ä¸‹è½½å¿«æ·æŒ‡ä»¤
                                </button>
                                <button class="btn-shortcut-guide" onclick="showShortcutGuide('720p_downloader')">
                                    ğŸ“– ä½¿ç”¨è¯´æ˜
                                </button>
                            </div>
                        </div>

                        <div class="shortcut-card">
                            <div class="shortcut-icon">âš¡</div>
                            <h4>æ‰¹é‡ä¸‹è½½å™¨</h4>
                            <p>æ”¯æŒå¤šä¸ªè§†é¢‘æ‰¹é‡ä¸‹è½½</p>
                            <div class="shortcut-buttons">
                                <button class="btn-shortcut" onclick="downloadShortcut('batch_downloader')">
                                    ğŸ“¥ ä¸‹è½½å¿«æ·æŒ‡ä»¤
                                </button>
                                <button class="btn-shortcut-guide" onclick="showShortcutGuide('batch_downloader')">
                                    ğŸ“– ä½¿ç”¨è¯´æ˜
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="shortcuts-info">
                        <h4>ğŸ“‹ å®‰è£…æ­¥éª¤ï¼š</h4>
                        <ol>
                            <li>ç‚¹å‡»ä¸Šæ–¹"ğŸ“¥ ä¸‹è½½å¿«æ·æŒ‡ä»¤"æŒ‰é’®</li>
                            <li>åœ¨å¼¹å‡ºçš„é¡µé¢ä¸­é€‰æ‹©"ç”¨å¿«æ·æŒ‡ä»¤æ‰“å¼€"</li>
                            <li>ç‚¹å‡»"æ·»åŠ å¿«æ·æŒ‡ä»¤"å®Œæˆå®‰è£…</li>
                            <li>å¤åˆ¶è§†é¢‘é“¾æ¥ï¼Œè¿è¡Œå¿«æ·æŒ‡ä»¤å³å¯ä¸‹è½½</li>
                        </ol>

                        <div class="server-config">
                            <h4>ğŸ”§ æœåŠ¡å™¨é…ç½®ï¼š</h4>
                            <p>å½“å‰æœåŠ¡å™¨åœ°å€ï¼š<code id="server-address">http://localhost:8080</code></p>
                            <button class="btn-secondary" onclick="updateServerAddress()">æ›´æ–°æœåŠ¡å™¨åœ°å€</button>
                        </div>
                    </div>
                </div>

                <!-- ä¸‹è½½å†å² -->
                <div class="downloads-section">
                    <h3>ä¸‹è½½å†å²</h3>
                    <div id="downloads-list"></div>
                </div>
            </div>

            <!-- å³ä¾§é¢æ¿ - é«˜çº§é€‰é¡¹ -->
            <div class="right-panel">
                <h3 style="margin-bottom: 20px; color: #2c3e50;">é«˜çº§é€‰é¡¹</h3>

                <div class="tabs">
                    <button class="tab active" data-tab="format">æ ¼å¼</button>
                    <button class="tab" data-tab="options">é€‰é¡¹</button>
                </div>

                <!-- æ ¼å¼é€‰æ‹©æ ‡ç­¾é¡µ -->
                <div id="format-tab" class="tab-content active">
                    <div class="format-grid">
                        <div class="input-group">
                            <label for="video-quality">è§†é¢‘è´¨é‡ï¼š</label>
                            <select id="video-quality">
                                <option value="best">æœ€ä½³è´¨é‡</option>
                                <option value="worst">æœ€ä½è´¨é‡</option>
                                <option value="1080">1080p</option>
                                <option value="720">720p</option>
                                <option value="480">480p</option>
                                <option value="360">360p</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label for="audio-quality">éŸ³é¢‘è´¨é‡ï¼š</label>
                            <select id="audio-quality">
                                <option value="best">æœ€ä½³è´¨é‡</option>
                                <option value="worst">æœ€ä½è´¨é‡</option>
                                <option value="320">320 kbps</option>
                                <option value="256">256 kbps</option>
                                <option value="192">192 kbps</option>
                                <option value="128">128 kbps</option>
                            </select>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="output-format">è¾“å‡ºæ ¼å¼ï¼š</label>
                        <select id="output-format">
                            <option value="best">è‡ªåŠ¨é€‰æ‹©</option>
                            <option value="mp4">MP4 (è§†é¢‘)</option>
                            <option value="webm">WebM (è§†é¢‘)</option>
                            <option value="mkv">MKV (è§†é¢‘)</option>
                            <option value="mp3">MP3 (éŸ³é¢‘)</option>
                            <option value="aac">AAC (éŸ³é¢‘)</option>
                            <option value="flac">FLAC (éŸ³é¢‘)</option>
                            <option value="wav">WAV (éŸ³é¢‘)</option>
                        </select>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="audio-only">
                        <label for="audio-only">ä»…æå–éŸ³é¢‘</label>
                    </div>
                </div>

                <!-- é€‰é¡¹æ ‡ç­¾é¡µ -->
                <div id="options-tab" class="tab-content">
                    <div class="checkbox-group">
                        <input type="checkbox" id="download-subtitles">
                        <label for="download-subtitles">ä¸‹è½½å­—å¹•</label>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="download-thumbnail">
                        <label for="download-thumbnail">ä¸‹è½½ç¼©ç•¥å›¾</label>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="download-description">
                        <label for="download-description">ä¸‹è½½æè¿°</label>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="download-playlist">
                        <label for="download-playlist">ä¸‹è½½æ•´ä¸ªæ’­æ”¾åˆ—è¡¨</label>
                    </div>

                    <div class="input-group">
                        <label for="subtitle-lang">å­—å¹•è¯­è¨€ï¼š</label>
                        <select id="subtitle-lang">
                            <option value="all">æ‰€æœ‰å¯ç”¨è¯­è¨€</option>
                            <option value="zh">ä¸­æ–‡</option>
                            <option value="en">è‹±æ–‡</option>
                            <option value="ja">æ—¥æ–‡</option>
                            <option value="ko">éŸ©æ–‡</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¿«æ·æŒ‡ä»¤ä½¿ç”¨è¯´æ˜å¼¹çª— -->
    <div id="shortcut-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">å¿«æ·æŒ‡ä»¤ä½¿ç”¨è¯´æ˜</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div id="modal-body" class="guide-content">
                <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>
        </div>
    </div>

    <script>
        let currentDownloadId = null;
        let statusCheckInterval = null;
        let currentPreset = 'best';

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // é¦–å…ˆæ£€æŸ¥è®¤è¯çŠ¶æ€
            checkAuthStatus().then(isAuthenticated => {
                if (!isAuthenticated) {
                    // æœªè®¤è¯ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ
                    window.location.href = '/login?redirect=' + encodeURIComponent(window.location.pathname);
                    return;
                }

                // å·²è®¤è¯ï¼Œç»§ç»­åˆå§‹åŒ–
                initializeTabs();
                initializePresets();
                initializeUrlValidation();
                loadRecentDownloads();
                initializeShortcuts();

                // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
                displayUserInfo();
            });
        });

        // æ£€æŸ¥è®¤è¯çŠ¶æ€ï¼ˆæ”¹è¿›ç‰ˆï¼‰
        async function checkAuthStatus() {
            try {
                // 1. ä¼˜å…ˆæ£€æŸ¥localStorageä¸­çš„token
                const token = localStorage.getItem('auth_token');
                if (token) {
                    console.log('ğŸ” æ£€æŸ¥Tokenè®¤è¯...');
                    const response = await fetch('/api/auth/verify', {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.valid) {
                            console.log('âœ… Tokenè®¤è¯æˆåŠŸ:', data.username);
                            return true;
                        }
                    }

                    // tokenæ— æ•ˆï¼Œæ¸…é™¤
                    console.log('âš ï¸ Tokenæ— æ•ˆï¼Œæ¸…é™¤localStorage');
                    localStorage.removeItem('auth_token');
                }

                // 2. æ£€æŸ¥sessionè®¤è¯
                console.log('ğŸ” æ£€æŸ¥Sessionè®¤è¯...');
                const sessionResponse = await fetch('/api/auth/verify', {
                    method: 'GET',
                    credentials: 'include'  // ç¡®ä¿å‘é€cookies
                });

                if (sessionResponse.ok) {
                    const data = await sessionResponse.json();
                    if (data.valid) {
                        console.log('âœ… Sessionè®¤è¯æˆåŠŸ:', data.username);
                        return true;
                    }
                }

                console.log('âŒ è®¤è¯å¤±è´¥ï¼Œéœ€è¦ç™»å½•');
                return false;

            } catch (error) {
                console.error('âŒ è®¤è¯æ£€æŸ¥å¼‚å¸¸:', error);
                return false;
            }
        }

        // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
        async function displayUserInfo() {
            try {
                const token = localStorage.getItem('auth_token');
                console.log('Token found:', !!token);
                if (!token) return;

                const response = await fetch('/api/auth/verify', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                console.log('Auth verify response:', response.status);
                if (response.ok) {
                    const data = await response.json();
                    console.log('Auth data:', data);
                    if (data.valid && data.username) {
                        // åœ¨é¡µé¢å¤´éƒ¨æ·»åŠ ç”¨æˆ·ä¿¡æ¯å’Œç™»å‡ºæŒ‰é’®
                        console.log('Adding user controls for:', data.username);
                        addUserControls(data.username);
                    } else {
                        console.warn('Invalid auth data or missing username');
                    }
                } else {
                    console.warn('Auth verify failed:', response.status);
                }
            } catch (error) {
                console.error('Failed to get user info:', error);
            }
        }

        // æ·»åŠ ç”¨æˆ·æ§åˆ¶åŒºåŸŸ
        function addUserControls(username) {
            const header = document.querySelector('.header');
            console.log('Header element found:', !!header);

            // æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨ç”¨æˆ·æ§åˆ¶åŒºåŸŸ
            const existingControls = header?.querySelector('[data-user-controls]');
            if (existingControls) {
                console.log('Removing existing user controls');
                existingControls.remove();
            }

            const userControls = document.createElement('div');
            userControls.setAttribute('data-user-controls', 'true');
            userControls.style.cssText = `
                position: absolute;
                top: 20px;
                right: 30px;
                color: white;
                display: flex;
                align-items: center;
                gap: 15px;
                z-index: 10;
            `;

            userControls.innerHTML = `
                <span style="opacity: 0.9;">ğŸ‘¤ ${username}</span>
                <button onclick="window.open('/admin', '_blank')" style="
                    background: rgba(255,255,255,0.2);
                    color: white;
                    border: 1px solid rgba(255,255,255,0.3);
                    padding: 8px 15px;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 14px;
                    transition: all 0.3s;
                    margin-right: 10px;
                " onmouseover="this.style.background='rgba(255,255,255,0.3)'"
                   onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                    âš™ï¸ é…ç½®
                </button>
                <button onclick="logout()" style="
                    background: rgba(255,255,255,0.2);
                    color: white;
                    border: 1px solid rgba(255,255,255,0.3);
                    padding: 8px 15px;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 14px;
                    transition: all 0.3s;
                " onmouseover="this.style.background='rgba(255,255,255,0.3)'"
                   onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                    ğŸšª ç™»å‡º
                </button>
            `;

            if (header) {
                header.appendChild(userControls);
                console.log('User controls added successfully');

                // éªŒè¯æŒ‰é’®æ˜¯å¦æ­£ç¡®æ·»åŠ 
                const configButton = userControls.querySelector('button[onclick*="admin"]');
                console.log('Config button found:', !!configButton);
            } else {
                console.error('Header element not found, cannot add user controls');
            }
        }

        // ç™»å‡ºåŠŸèƒ½
        async function logout() {
            try {
                const token = localStorage.getItem('auth_token');
                if (token) {
                    await fetch('/api/auth/logout', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                }
            } catch (error) {
                console.error('Logout error:', error);
            } finally {
                // æ¸…é™¤æœ¬åœ°å­˜å‚¨å¹¶é‡å®šå‘åˆ°ç™»å½•é¡µ
                localStorage.removeItem('auth_token');
                window.location.href = '/login';
            }
        }

        // æ ‡ç­¾é¡µåŠŸèƒ½
        function initializeTabs() {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetTab = tab.dataset.tab;

                    // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(tc => tc.classList.remove('active'));

                    // æ¿€æ´»å½“å‰æ ‡ç­¾
                    tab.classList.add('active');
                    document.getElementById(targetTab + '-tab').classList.add('active');
                });
            });
        }

        // é¢„è®¾åŠŸèƒ½
        function initializePresets() {
            const presetBtns = document.querySelectorAll('.preset-btn');

            presetBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                    presetBtns.forEach(b => b.classList.remove('active'));

                    // æ¿€æ´»å½“å‰é¢„è®¾
                    btn.classList.add('active');
                    currentPreset = btn.dataset.preset;

                    // åº”ç”¨é¢„è®¾é…ç½®
                    applyPreset(currentPreset);
                });
            });
        }

        // åº”ç”¨é¢„è®¾é…ç½®
        function applyPreset(preset) {
            const videoQuality = document.getElementById('video-quality');
            const audioQuality = document.getElementById('audio-quality');
            const outputFormat = document.getElementById('output-format');
            const audioOnly = document.getElementById('audio-only');

            switch(preset) {
                case 'best':
                    videoQuality.value = 'best';
                    audioQuality.value = 'best';
                    outputFormat.value = 'best';
                    audioOnly.checked = false;
                    break;
                case 'mp4':
                    videoQuality.value = 'best';
                    audioQuality.value = 'best';
                    outputFormat.value = 'mp4';
                    audioOnly.checked = false;
                    break;
                case 'mp3':
                    audioQuality.value = '320';
                    outputFormat.value = 'mp3';
                    audioOnly.checked = true;
                    break;
                case '720p':
                    videoQuality.value = '720';
                    audioQuality.value = 'best';
                    outputFormat.value = 'mp4';
                    audioOnly.checked = false;
                    break;
                case '480p':
                    videoQuality.value = '480';
                    audioQuality.value = 'best';
                    outputFormat.value = 'mp4';
                    audioOnly.checked = false;
                    break;
                case 'custom':
                    // è‡ªå®šä¹‰æ¨¡å¼ä¸æ”¹å˜ä»»ä½•è®¾ç½®
                    break;
            }
        }

        // URLéªŒè¯
        function initializeUrlValidation() {
            const urlInput = document.getElementById('url');
            const urlValidation = document.getElementById('url-validation');

            urlInput.addEventListener('input', function() {
                const url = this.value.trim();

                if (!url) {
                    urlValidation.textContent = '';
                    urlValidation.className = 'url-validation';
                    return;
                }

                // ç®€å•çš„URLéªŒè¯
                const urlPattern = /^https?:\/\/.+/;
                if (urlPattern.test(url)) {
                    urlValidation.textContent = 'âœ“';
                    urlValidation.className = 'url-validation valid';
                } else {
                    urlValidation.textContent = 'âœ—';
                    urlValidation.className = 'url-validation invalid';
                }
            });

            // å›è½¦é”®ä¸‹è½½
            urlInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    startDownload();
                }
            });
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message, type = 'info') {
            const messageArea = document.getElementById('message-area');
            const className = type === 'error' ? 'error-message' : 'success-message';
            messageArea.innerHTML = `<div class="${className}">${message}</div>`;
            setTimeout(() => {
                messageArea.innerHTML = '';
            }, 5000);
        }

        // è®¾ç½®åŠ è½½çŠ¶æ€
        function setLoading(buttonId, loadingId, isLoading) {
            const button = document.getElementById(buttonId);
            const loading = document.getElementById(loadingId);

            if (isLoading) {
                button.classList.add('hidden');
                loading.classList.remove('hidden');
            } else {
                button.classList.remove('hidden');
                loading.classList.add('hidden');
            }
        }

        // è·å–è®¤è¯å¤´
        function getAuthHeaders() {
            const token = localStorage.getItem('auth_token');
            const headers = {
                'Content-Type': 'application/json',
            };
            if (token) {
                headers['Authorization'] = `Bearer ${token}`;
            }
            return headers;
        }

        // é€šç”¨ API è¯·æ±‚å‡½æ•°ï¼Œè‡ªåŠ¨å¤„ç†è®¤è¯é”™è¯¯
        async function apiRequest(url, options = {}) {
            const token = localStorage.getItem('auth_token');
            const headers = options.headers || {};

            if (token) {
                headers['Authorization'] = `Bearer ${token}`;
            }

            const requestOptions = {
                ...options,
                headers: headers
            };

            try {
                const response = await fetch(url, requestOptions);

                // å¤„ç†è®¤è¯é”™è¯¯
                if (response.status === 401) {
                    console.warn('è®¤è¯å¤±è´¥ï¼Œæ¸…é™¤tokenå¹¶è·³è½¬åˆ°ç™»å½•é¡µ');
                    localStorage.removeItem('auth_token');
                    showMessage('ä¼šè¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•', 'error');
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 2000);
                    throw new Error('Authentication failed');
                }

                return response;
            } catch (error) {
                if (error.message === 'Authentication failed') {
                    throw error;
                }
                console.error('API request failed:', error);
                throw error;
            }
        }

        // è·å–è§†é¢‘ä¿¡æ¯
        async function getVideoInfo() {
            const url = document.getElementById('url').value.trim();
            if (!url) {
                showMessage('è¯·è¾“å…¥è§†é¢‘é“¾æ¥', 'error');
                return;
            }

            setLoading('info-btn-text', 'info-loading', true);

            try {
                const response = await apiRequest('/api/info', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ url: url })
                });

                const data = await response.json();

                if (response.ok) {
                    displayVideoInfo(data);
                    document.getElementById('video-info-section').classList.add('show');
                } else {
                    showMessage(data.error || 'è·å–è§†é¢‘ä¿¡æ¯å¤±è´¥', 'error');
                }
            } catch (error) {
                if (error.message !== 'Authentication failed') {
                    showMessage('ç½‘ç»œé”™è¯¯ï¼š' + error.message, 'error');
                }
            } finally {
                setLoading('info-btn-text', 'info-loading', false);
            }
        }

        // æ˜¾ç¤ºè§†é¢‘ä¿¡æ¯
        function displayVideoInfo(info) {
            const videoInfoDiv = document.getElementById('video-info');
            const duration = info.duration ? formatDuration(info.duration) : 'æœªçŸ¥';
            const fileSize = info.filesize ? formatFileSize(info.filesize) : 'æœªçŸ¥';

            videoInfoDiv.innerHTML = `
                <h3>${info.title || 'æœªçŸ¥æ ‡é¢˜'}</h3>
                <p><strong>ä¸Šä¼ è€…ï¼š</strong> ${info.uploader || 'æœªçŸ¥'}</p>
                <p><strong>æ—¶é•¿ï¼š</strong> ${duration}</p>
                <p><strong>è§‚çœ‹æ¬¡æ•°ï¼š</strong> ${info.view_count ? info.view_count.toLocaleString() : 'æœªçŸ¥'}</p>
                <p><strong>é¢„ä¼°å¤§å°ï¼š</strong> ${fileSize}</p>
                ${info.description ? `<p><strong>æè¿°ï¼š</strong> ${info.description.substring(0, 200)}...</p>` : ''}
            `;
        }

        // å¼€å§‹ä¸‹è½½
        async function startDownload() {
            const url = document.getElementById('url').value.trim();
            if (!url) {
                showMessage('è¯·è¾“å…¥è§†é¢‘é“¾æ¥', 'error');
                return;
            }

            // æ”¶é›†æ‰€æœ‰é€‰é¡¹
            const options = {
                url: url,
                video_quality: document.getElementById('video-quality').value,
                audio_quality: document.getElementById('audio-quality').value,
                output_format: document.getElementById('output-format').value,
                audio_only: document.getElementById('audio-only').checked,
                download_subtitles: document.getElementById('download-subtitles').checked,
                download_thumbnail: document.getElementById('download-thumbnail').checked,
                download_description: document.getElementById('download-description').checked,
                download_playlist: document.getElementById('download-playlist').checked,
                subtitle_lang: document.getElementById('subtitle-lang').value,
                preset: currentPreset
            };

            setLoading('download-btn-text', 'download-loading', true);

            try {
                const response = await apiRequest('/api/download', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(options)
                });

                const data = await response.json();

                if (response.ok) {
                    currentDownloadId = data.download_id;
                    showMessage('ä¸‹è½½å·²æˆåŠŸå¼€å§‹ï¼', 'success');
                    document.getElementById('download-status-section').classList.add('show');
                    startStatusCheck();
                } else {
                    showMessage(data.error || 'å¼€å§‹ä¸‹è½½å¤±è´¥', 'error');
                }
            } catch (error) {
                if (error.message !== 'Authentication failed') {
                    showMessage('ç½‘ç»œé”™è¯¯ï¼š' + error.message, 'error');
                }
            } finally {
                setLoading('download-btn-text', 'download-loading', false);
            }
        }

        // å¼€å§‹çŠ¶æ€æ£€æŸ¥
        function startStatusCheck() {
            if (statusCheckInterval) {
                clearInterval(statusCheckInterval);
            }
            statusCheckInterval = setInterval(checkDownloadStatus, 1000);
        }

        // æ£€æŸ¥ä¸‹è½½çŠ¶æ€
        async function checkDownloadStatus() {
            if (!currentDownloadId) return;

            try {
                const response = await apiRequest(`/api/download/${currentDownloadId}/status`);
                const data = await response.json();

                if (response.ok) {
                    updateDownloadStatus(data);

                    if (data.status === 'completed' || data.status === 'error') {
                        clearInterval(statusCheckInterval);
                        statusCheckInterval = null;
                        loadRecentDownloads();
                    }
                } else {
                    console.error('Status check failed:', response.status, data);
                    showMessage(data.error || 'çŠ¶æ€æ£€æŸ¥å¤±è´¥', 'error');
                }
            } catch (error) {
                if (error.message === 'Authentication failed') {
                    // è®¤è¯å¤±è´¥æ—¶åœæ­¢çŠ¶æ€æ£€æŸ¥
                    clearInterval(statusCheckInterval);
                    statusCheckInterval = null;
                } else {
                    console.error('Error checking download status:', error);
                    showMessage('ç½‘ç»œé”™è¯¯ï¼š' + error.message, 'error');
                }
            }
        }

        // æ›´æ–°ä¸‹è½½çŠ¶æ€
        function updateDownloadStatus(download) {
            const statusDiv = document.getElementById('download-status');
            const progressContainer = document.getElementById('progress-container');
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');

            // çŠ¶æ€ç¿»è¯‘
            const statusMap = {
                'pending': 'ç­‰å¾…ä¸­',
                'downloading': 'ä¸‹è½½ä¸­',
                'completed': 'å·²å®Œæˆ',
                'error': 'é”™è¯¯'
            };

            statusDiv.innerHTML = `
                <p><strong>çŠ¶æ€ï¼š</strong> ${statusMap[download.status] || download.status}</p>
                <p><strong>é“¾æ¥ï¼š</strong> ${download.url}</p>
                ${download.filename ? `<p><strong>æ–‡ä»¶ï¼š</strong> <a href="/downloads/${download.filename}" target="_blank">${download.filename}</a></p>` : ''}
                ${download.error ? `<p><strong>é”™è¯¯ï¼š</strong> ${download.error}</p>` : ''}
            `;

            if (download.status === 'downloading' && download.progress > 0) {
                progressContainer.classList.remove('hidden');
                progressFill.style.width = `${download.progress}%`;
                progressText.textContent = `${Math.round(download.progress)}%`;

                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                updateDownloadStats(download);
            } else if (download.status === 'completed') {
                progressContainer.classList.remove('hidden');
                progressFill.style.width = '100%';
                progressText.textContent = '100% - å·²å®Œæˆ';

                // æ¸…ç©ºç»Ÿè®¡ä¿¡æ¯
                document.getElementById('download-speed').textContent = '0 KB/s';
                document.getElementById('eta').textContent = 'å·²å®Œæˆ';
            } else {
                progressContainer.classList.add('hidden');
            }
        }

        // æ›´æ–°ä¸‹è½½ç»Ÿè®¡
        function updateDownloadStats(download) {
            if (download.speed) {
                document.getElementById('download-speed').textContent = formatSpeed(download.speed);
            }
            if (download.total_bytes) {
                document.getElementById('file-size').textContent = formatFileSize(download.total_bytes);
            }
            if (download.eta) {
                document.getElementById('eta').textContent = formatTime(download.eta);
            }
        }

        // åŠ è½½æœ€è¿‘ä¸‹è½½
        async function loadRecentDownloads() {
            try {
                const response = await apiRequest('/api/downloads');
                const data = await response.json();

                if (response.ok) {
                    displayRecentDownloads(data.downloads);
                } else {
                    console.error('Failed to load downloads:', response.status, data);
                    showMessage(data.error || 'åŠ è½½ä¸‹è½½åˆ—è¡¨å¤±è´¥', 'error');
                }
            } catch (error) {
                if (error.message !== 'Authentication failed') {
                    console.error('Error loading recent downloads:', error);
                    showMessage('ç½‘ç»œé”™è¯¯ï¼š' + error.message, 'error');
                }
            }
        }

        // æ˜¾ç¤ºæœ€è¿‘ä¸‹è½½
        function displayRecentDownloads(downloads) {
            const downloadsDiv = document.getElementById('downloads-list');

            if (downloads.length === 0) {
                downloadsDiv.innerHTML = '<p style="text-align: center; color: #7f8c8d;">æš‚æ— ä¸‹è½½è®°å½•</p>';
                return;
            }

            // çŠ¶æ€ç¿»è¯‘
            const statusMap = {
                'pending': 'ç­‰å¾…ä¸­',
                'downloading': 'ä¸‹è½½ä¸­',
                'completed': 'å·²å®Œæˆ',
                'error': 'é”™è¯¯'
            };

            const downloadItems = downloads.slice(-10).reverse().map(download => {
                const statusClass = download.status === 'completed' ? 'completed' :
                                  download.status === 'error' ? 'error' : '';

                return `
                    <div class="download-item ${statusClass}">
                        <p><strong>çŠ¶æ€ï¼š</strong> ${statusMap[download.status] || download.status}</p>
                        <p><strong>é“¾æ¥ï¼š</strong> <span style="word-break: break-all;">${download.url}</span></p>
                        ${download.filename ? `<p><strong>æ–‡ä»¶ï¼š</strong> <a href="/downloads/${download.filename}" target="_blank">${download.filename}</a></p>` : ''}
                        <p><strong>å¼€å§‹æ—¶é—´ï¼š</strong> ${new Date(download.created_at).toLocaleString()}</p>
                    </div>
                `;
            }).join('');

            downloadsDiv.innerHTML = downloadItems;
        }

        // å·¥å…·å‡½æ•°
        function formatDuration(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;

            if (hours > 0) {
                return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            } else {
                return `${minutes}:${secs.toString().padStart(2, '0')}`;
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function formatSpeed(bytesPerSecond) {
            return formatFileSize(bytesPerSecond) + '/s';
        }

        function formatTime(seconds) {
            if (seconds < 60) {
                return `${Math.round(seconds)}ç§’`;
            } else if (seconds < 3600) {
                const minutes = Math.floor(seconds / 60);
                const secs = Math.round(seconds % 60);
                return `${minutes}åˆ†${secs}ç§’`;
            } else {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                return `${hours}å°æ—¶${minutes}åˆ†`;
            }
        }

        // iOSå¿«æ·æŒ‡ä»¤ç›¸å…³åŠŸèƒ½
        function initializeShortcuts() {
            // è‡ªåŠ¨æ£€æµ‹æœåŠ¡å™¨åœ°å€
            const serverAddress = window.location.origin;
            document.getElementById('server-address').textContent = serverAddress;
        }

        // ä¸‹è½½å¿«æ·æŒ‡ä»¤
        function downloadShortcut(shortcutType) {
            const serverAddress = document.getElementById('server-address').textContent;
            const shortcutUrl = `${serverAddress}/api/shortcuts/download-file/${shortcutType}`;

            // åœ¨æ–°çª—å£æ‰“å¼€ä¸‹è½½é“¾æ¥
            window.open(shortcutUrl, '_blank');

            // æ˜¾ç¤ºå®‰è£…æç¤º
            showMessage('å¿«æ·æŒ‡ä»¤ä¸‹è½½å·²å¼€å§‹ï¼Œè¯·åœ¨å¼¹å‡ºé¡µé¢ä¸­é€‰æ‹©"ç”¨å¿«æ·æŒ‡ä»¤æ‰“å¼€"', 'success');
        }

        // æ˜¾ç¤ºå¿«æ·æŒ‡ä»¤ä½¿ç”¨è¯´æ˜
        function showShortcutGuide(shortcutType) {
            const modal = document.getElementById('shortcut-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');

            const guides = {
                'smart_downloader': {
                    title: 'ğŸ¬ æ™ºèƒ½è§†é¢‘ä¸‹è½½å™¨ä½¿ç”¨è¯´æ˜',
                    content: `
                        <h4>åŠŸèƒ½ç‰¹ç‚¹ï¼š</h4>
                        <ul>
                            <li>æ”¯æŒæ ¼å¼é€‰æ‹©èœå•ï¼ˆæœ€ä½³è´¨é‡ã€720Pã€480Pã€MP3ç­‰ï¼‰</li>
                            <li>è‡ªåŠ¨è¯†åˆ«è§†é¢‘/éŸ³é¢‘ç±»å‹</li>
                            <li>æ™ºèƒ½ä¿å­˜åˆ°ç›¸å†Œæˆ–æ–‡ä»¶app</li>
                        </ul>

                        <h4>ä½¿ç”¨æ­¥éª¤ï¼š</h4>
                        <ol>
                            <li>å¤åˆ¶è§†é¢‘é“¾æ¥åˆ°å‰ªè´´æ¿</li>
                            <li>è¿è¡Œ"æ™ºèƒ½è§†é¢‘ä¸‹è½½å™¨"å¿«æ·æŒ‡ä»¤</li>
                            <li>ä»èœå•ä¸­é€‰æ‹©ä¸‹è½½æ ¼å¼</li>
                            <li>ç­‰å¾…ä¸‹è½½å®Œæˆï¼Œæ–‡ä»¶è‡ªåŠ¨ä¿å­˜</li>
                        </ol>

                        <h4>æ”¯æŒçš„æ ¼å¼ï¼š</h4>
                        <ul>
                            <li>ğŸ¬ æœ€ä½³è´¨é‡è§†é¢‘ - ä¿å­˜åˆ°ç›¸å†Œ</li>
                            <li>ğŸ“± 720Pè§†é¢‘ - ä¿å­˜åˆ°ç›¸å†Œ</li>
                            <li>ğŸ’¾ 480Pè§†é¢‘ - ä¿å­˜åˆ°ç›¸å†Œ</li>
                            <li>ğŸµ é«˜å“è´¨MP3 - ä¿å­˜åˆ°æ–‡ä»¶</li>
                            <li>ğŸ¶ æ ‡å‡†MP3 - ä¿å­˜åˆ°æ–‡ä»¶</li>
                        </ul>
                    `
                },
                'audio_extractor': {
                    title: 'ğŸµ éŸ³é¢‘æå–å™¨ä½¿ç”¨è¯´æ˜',
                    content: `
                        <h4>åŠŸèƒ½ç‰¹ç‚¹ï¼š</h4>
                        <ul>
                            <li>ä¸“é—¨æå–è§†é¢‘ä¸­çš„éŸ³é¢‘</li>
                            <li>è¾“å‡ºé«˜å“è´¨MP3æ ¼å¼</li>
                            <li>è‡ªåŠ¨ä¿å­˜åˆ°æ–‡ä»¶app</li>
                        </ul>

                        <h4>ä½¿ç”¨æ­¥éª¤ï¼š</h4>
                        <ol>
                            <li>å¤åˆ¶è§†é¢‘é“¾æ¥</li>
                            <li>è¿è¡Œ"éŸ³é¢‘æå–å™¨"å¿«æ·æŒ‡ä»¤</li>
                            <li>ç­‰å¾…æå–å®Œæˆ</li>
                            <li>éŸ³é¢‘æ–‡ä»¶ä¿å­˜åˆ°iCloud Drive/Downloads</li>
                        </ol>

                        <h4>è¾“å‡ºæ ¼å¼ï¼š</h4>
                        <p>320kbps MP3éŸ³é¢‘ï¼Œé€‚åˆéŸ³ä¹æ”¶è—</p>
                    `
                },
                '720p_downloader': {
                    title: 'ğŸ“± 720Pä¸‹è½½å™¨ä½¿ç”¨è¯´æ˜',
                    content: `
                        <h4>åŠŸèƒ½ç‰¹ç‚¹ï¼š</h4>
                        <ul>
                            <li>ä¸“é—¨ä¸‹è½½720Pé«˜æ¸…è§†é¢‘</li>
                            <li>é€‚åˆæ‰‹æœºè§‚çœ‹çš„åˆ†è¾¨ç‡</li>
                            <li>æ–‡ä»¶å¤§å°é€‚ä¸­ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´</li>
                        </ul>

                        <h4>ä½¿ç”¨æ­¥éª¤ï¼š</h4>
                        <ol>
                            <li>å¤åˆ¶è§†é¢‘é“¾æ¥</li>
                            <li>è¿è¡Œ"720Pä¸‹è½½å™¨"å¿«æ·æŒ‡ä»¤</li>
                            <li>ç­‰å¾…ä¸‹è½½å®Œæˆ</li>
                            <li>è§†é¢‘ä¿å­˜åˆ°ç›¸å†Œ</li>
                        </ol>

                        <h4>é€‚ç”¨åœºæ™¯ï¼š</h4>
                        <p>æ‰‹æœºè§‚çœ‹ã€å­˜å‚¨ç©ºé—´æœ‰é™ã€ç½‘ç»œå¸¦å®½è¾ƒå°çš„æƒ…å†µ</p>
                    `
                },
                'batch_downloader': {
                    title: 'âš¡ æ‰¹é‡ä¸‹è½½å™¨ä½¿ç”¨è¯´æ˜',
                    content: `
                        <h4>åŠŸèƒ½ç‰¹ç‚¹ï¼š</h4>
                        <ul>
                            <li>æ”¯æŒå¤šä¸ªè§†é¢‘é“¾æ¥æ‰¹é‡ä¸‹è½½</li>
                            <li>å¼‚æ­¥ä¸‹è½½ï¼Œæ”¯æŒå¤§æ–‡ä»¶</li>
                            <li>æ˜¾ç¤ºä¸‹è½½è¿›åº¦</li>
                        </ul>

                        <h4>ä½¿ç”¨æ­¥éª¤ï¼š</h4>
                        <ol>
                            <li>å‡†å¤‡å¤šä¸ªè§†é¢‘é“¾æ¥ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</li>
                            <li>è¿è¡Œ"æ‰¹é‡ä¸‹è½½å™¨"å¿«æ·æŒ‡ä»¤</li>
                            <li>è¾“å…¥æˆ–ç²˜è´´é“¾æ¥åˆ—è¡¨</li>
                            <li>é€‰æ‹©ä¸‹è½½æ ¼å¼</li>
                            <li>ç­‰å¾…æ‰€æœ‰ä¸‹è½½å®Œæˆ</li>
                        </ol>

                        <h4>æ³¨æ„äº‹é¡¹ï¼š</h4>
                        <ul>
                            <li>å¤§é‡ä¸‹è½½å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´</li>
                            <li>å»ºè®®åœ¨WiFiç¯å¢ƒä¸‹ä½¿ç”¨</li>
                            <li>ç¡®ä¿è®¾å¤‡æœ‰è¶³å¤Ÿå­˜å‚¨ç©ºé—´</li>
                        </ul>
                    `
                }
            };

            const guide = guides[shortcutType];
            if (guide) {
                modalTitle.textContent = guide.title;
                modalBody.innerHTML = guide.content;
                modal.style.display = 'block';
            }
        }

        // å…³é—­å¼¹çª—
        function closeModal() {
            document.getElementById('shortcut-modal').style.display = 'none';
        }

        // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const modal = document.getElementById('shortcut-modal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // æ›´æ–°æœåŠ¡å™¨åœ°å€
        function updateServerAddress() {
            const newAddress = prompt('è¯·è¾“å…¥æ–°çš„æœåŠ¡å™¨åœ°å€:', document.getElementById('server-address').textContent);
            if (newAddress && newAddress.trim()) {
                document.getElementById('server-address').textContent = newAddress.trim();
                showMessage('æœåŠ¡å™¨åœ°å€å·²æ›´æ–°ï¼Œè¯·é‡æ–°ä¸‹è½½å¿«æ·æŒ‡ä»¤', 'success');
            }
        }
    </script>
</body>
</html>
