# iOS快捷指令格式选择完整指南

## 快捷指令格式选择的三种实现方式

### 方式一：预设格式快捷指令（最简单）

创建多个专用快捷指令，每个预设不同格式：

#### 1. "下载MP3音频"快捷指令
```
动作1: 获取剪贴板
动作2: 获取网页内容
  - URL: http://你的服务器:8080/api/shortcuts/download-direct
  - 方法: POST
  - 请求体: {
      "url": "[剪贴板]",
      "audio_only": "true",
      "output_format": "mp3",
      "audio_quality": "320"
    }
动作3: 保存到文件 (音乐文件夹)
```

#### 2. "下载720P视频"快捷指令
```
动作1: 获取剪贴板
动作2: 获取网页内容
  - URL: http://你的服务器:8080/api/shortcuts/download-direct
  - 方法: POST
  - 请求体: {
      "url": "[剪贴板]",
      "audio_only": "false",
      "video_quality": "best[height<=720]",
      "output_format": "mp4"
    }
动作3: 保存到相册
```

### 方式二：交互式菜单选择（推荐）

#### 智能下载器快捷指令步骤：

**步骤1: 获取视频链接**
```
动作: 获取剪贴板
说明: 自动获取复制的视频链接
```

**步骤2: 格式选择菜单**
```
动作: 从菜单中选择
提示: "请选择下载格式"
选项:
  🎬 最佳质量视频 (best)
  📱 720P视频 (best[height<=720])
  💾 480P视频 (best[height<=480])
  🎵 高品质MP3 (mp3_320)
  🎶 标准MP3 (mp3_192)
  🔊 AAC音频 (aac)
  💎 FLAC无损 (flac)
```

**步骤3: 参数处理**
```
动作: 文本处理
根据选择的菜单项设置对应参数:
- 如果包含"视频" → audio_only = false
- 如果包含"MP3/AAC/FLAC" → audio_only = true
- 提取质量参数 (720/480/320/192等)
```

**步骤4: 发送下载请求**
```
动作: 获取网页内容
URL: http://你的服务器:8080/api/shortcuts/download-direct
方法: POST
请求体: {
  "url": "[剪贴板内容]",
  "audio_only": "[根据选择确定]",
  "video_quality": "[视频质量]",
  "audio_quality": "[音频质量]",
  "output_format": "[输出格式]"
}
```

**步骤5: 保存文件**
```
动作: 条件判断
如果 audio_only = true:
  保存到文件 → iCloud Drive/音乐
否则:
  保存到相册
```

### 方式三：动态格式检测（高级）

#### 高级下载器快捷指令步骤：

**步骤1: 获取链接**
```
动作: 请求输入
提示: "请输入视频链接"
类型: URL
默认值: [剪贴板内容]
```

**步骤2: 获取可用格式**
```
动作: 获取网页内容
URL: http://你的服务器:8080/api/formats
方法: POST
请求体: {"url": "[输入的链接]"}
```

**步骤3: 解析格式选项**
```
动作: 从词典获取值
键: "shortcut_options"
说明: 获取服务器返回的格式选项列表
```

**步骤4: 动态菜单选择**
```
动作: 从菜单中选择
提示: "选择下载格式"
选项: [从服务器获取的动态选项]
```

**步骤5: 下载和保存**
```
动作: 获取网页内容 + 保存文件
(同方式二)
```

## 支持的格式参数详解

### 视频质量参数
- `"best"` - 最佳质量
- `"best[height<=1080]"` - 不超过1080P的最佳质量
- `"best[height<=720]"` - 不超过720P的最佳质量
- `"best[height<=480]"` - 不超过480P的最佳质量
- `"worst"` - 最低质量

### 音频质量参数
- `"best"` - 最佳音频质量
- `"320"` - 320kbps
- `"256"` - 256kbps
- `"192"` - 192kbps
- `"128"` - 128kbps

### 输出格式参数
**视频格式:**
- `"mp4"` - MP4格式 (推荐)
- `"webm"` - WebM格式
- `"mkv"` - MKV格式

**音频格式:**
- `"mp3"` - MP3格式 (通用)
- `"aac"` - AAC格式 (高效)
- `"flac"` - FLAC格式 (无损)
- `"wav"` - WAV格式 (无压缩)

## 快捷指令实际配置示例

### 示例1: 简单MP3下载器

```
1. 获取剪贴板
2. 获取网页内容:
   URL: http://192.168.1.100:8080/api/shortcuts/download-direct
   方法: POST
   头部: Content-Type: application/json
   请求体: {
     "url": "剪贴板",
     "audio_only": "true",
     "output_format": "mp3",
     "audio_quality": "320"
   }
3. 保存到文件:
   位置: iCloud Drive/Downloads
```

### 示例2: 交互式视频下载器

```
1. 获取剪贴板
2. 从菜单中选择:
   提示: "选择视频质量"
   选项: ["🏆 最佳质量", "📱 720P", "💾 480P", "🎵 仅音频"]
3. 文本操作:
   替换文本: 
   - "🏆 最佳质量" → "best"
   - "📱 720P" → "best[height<=720]"
   - "💾 480P" → "best[height<=480]"
   - "🎵 仅音频" → "audio_only"
4. 条件判断:
   如果选择 = "audio_only":
     设置 audio_only = "true"
   否则:
     设置 audio_only = "false", video_quality = 选择结果
5. 获取网页内容 (发送请求)
6. 保存文件
```

## 高级功能

### 批量下载
```
1. 请求输入: "输入多个视频链接，每行一个"
2. 拆分文本: 按换行符分割
3. 重复操作: 对每个链接执行下载
```

### 进度显示
```
使用异步API (/api/shortcuts/download) 
配合轮询状态显示下载进度
```

### 错误处理
```
1. 检查HTTP状态码
2. 如果失败，显示错误信息
3. 可选择重试或跳过
```

这样iOS用户就可以根据需要选择最适合的格式选择方式了！
